<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>Event Loop in Node.js</title>

    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/reveal.css">
    <link rel="stylesheet" href="css/theme/league.css">

    <!-- Theme used for syntax highlighting of code -->
<!--    <link rel="stylesheet" href="lib/css/docco.css">-->
    <link rel="stylesheet" href="lib/css/xcode.css">

    <!-- Printing and PDF exports -->
    <script>
        var link = document.createElement('link');
        link.rel = 'stylesheet';
        link.type = 'text/css';
        link.href = window.location.search.match(/print-pdf/gi) ? 'css/print/pdf.css' : 'css/print/paper.css';
        document.getElementsByTagName('head')[0].appendChild(link);
    </script>

    <style>
        .columns-2 {
            display: grid;
            grid-template-columns: auto auto;
            grid-gap: 30px;
        }

        .columns-2-narrow {
            display: grid;
            grid-template-columns: auto auto;
            grid-gap: 100px;
            width: 80%;
            margin: 0 auto;
        }

        .columns-3 {
            display: grid;
            grid-template-columns: auto auto auto;
            grid-gap: 30px;
        }

        .schema {
            text-align: center;
        }

        .schema-block {
            padding: 10px;
            border: 2px solid #3e3e3e;
        }

        .block {
            padding: 10px 20px;
            border: 2px solid #ddd;
            margin: 16px 0;
            border-radius: 6px;
        }
    </style>

    <!--    <link rel="stylesheet" href="css/prism.css" data-manual>-->
</head>
<body class="line-numbers">
<div class="reveal">
    <div class="slides">
        <section>
            <h1>Event Loop in Node.js</h1>
            <footer>Alexey Ponomarev, JavaScript developer</footer>
            <aside class="notes">
                Hi, I’m Alexey, and I’m working closely with JavaScript since 2014 and today I want to tell about my
                experience with Node.js platform.
            </aside>
        </section>

        <section>
            <h2>What’s the point?</h2>
            <ul>
                <li>Concurrency</li>
                <li>Event Loop and Node.js</li>
            </ul>
            <aside class="notes">
                Let’s start. A few words about this talk. When I started to work with Node.js I got a quite big project.
                To be honest it was hard to understand all these asynchronous operations everywhere. A bit later I
                figured out how to work with it, but I was still wondering how it works under the hood.
            </aside>
        </section>

        <section data-background="image/01_cats.jpg" data-background-size="contain">
            <aside class="notes">
                So in the first place we’ll take a look onto the concurrency topic…
            </aside>
        </section>

        <section data-background="image/02_carousel.jpg" data-background-size="contain">
            <aside class="notes">
                …and then will dive into the event loop and will check how it works in Node.js
            </aside>
        </section>

        <section>
            <h2>Concurrency</h2>

            <div class="columns-3">
                <div class="fragment">
                    <p>single-threading</p>
                    <svg
                        width="180px"
                        viewBox="0 0 246 654"
                        xmlns="http://www.w3.org/2000/svg"
                        fill-rule="evenodd"
                        clip-rule="evenodd"
                        stroke-linejoin="round"
                        stroke-miterlimit="1.5"
                    >
                        <path fill="#ebebeb" d="M2.705 76.971h240v80h-240z" />
                        <path d="M242.705 156.97h-240V76.971h240v80zm-237-77v74.001h234v-74h-234z" />
                        <path fill="#ebebeb" d="M2.705 216.971h240v80h-240z" />
                        <path d="M242.705 296.97h-240v-79.999h240v80zm-237-77v74.001h234v-74h-234zM128.704 64.971l-6 12-6-12h12z" />
                        <path d="M122.704 16.971v50.4" fill="none" stroke="#000" stroke-width="4" />
                        <path d="M132.304 197.771l-9.6 19.2-9.6-19.2h19.2z" />
                        <path d="M122.704 156.971v44.64" fill="none" stroke="#000" stroke-width="8" />
                        <path fill="#ebebeb" d="M2.705 356.971h240v80h-240z" />
                        <path d="M242.705 436.97h-240v-79.999h240v80zm-237-77v74.001h234v-74h-234z" />
                        <path fill="#ebebeb" d="M2.705 496.971h240v80h-240z" />
                        <path d="M242.705 576.97h-240v-79.999h240v80zm-237-77v74.001h234v-74h-234zM128.704 344.972l-6 12-6-12h12z" />
                        <path d="M122.704 296.971v50.4" fill="none" stroke="#000" stroke-width="4" />
                        <g>
                            <path d="M128.704 624.972l-6 12-6-12h12z" />
                            <path d="M122.704 576.971v50.4" fill="none" stroke="#000" stroke-width="4" />
                        </g>
                        <g>
                            <path d="M132.304 477.772l-9.6 19.2-9.6-19.2h19.2z" />
                            <path d="M122.704 436.971v44.64" fill="none" stroke="#000" stroke-width="8" />
                        </g>
                        <text
                            x="196.675"
                            y="150.71"
                            font-family="'HelveticaNeue','Helvetica Neue'"
                            font-size="30"
                            transform="translate(-97.296 -23.03)"
                        >File
                        </text>
                        <g>
                            <text
                                x="131.095"
                                y="150.71"
                                font-family="'HelveticaNeue','Helvetica Neue'"
                                font-size="30"
                                transform="translate(-97.296 116.97)"
                            >
                                Data process
                            </text>
                        </g>
                        <g>
                            <text
                                x="163.63"
                                y="150.71"
                                font-family="'HelveticaNeue','Helvetica Neue'"
                                font-size="30"
                                transform="translate(-97.296 256.26)"
                            >Network
                            </text>
                        </g>
                        <g>
                            <text
                                x="131.095"
                                y="150.71"
                                font-family="'HelveticaNeue','Helvetica Neue'"
                                font-size="30"
                                transform="translate(-97.296 396.26)"
                            >
                                Data process
                            </text>
                        </g>
                    </svg>
                </div>
                <div class="fragment">
                    <p>multi-threading</p>
                    <svg
                        width="420px"
                        viewBox="0 0 566 481"
                        xmlns="http://www.w3.org/2000/svg"
                        fill-rule="evenodd"
                        clip-rule="evenodd"
                        stroke-linejoin="round"
                        stroke-miterlimit="1.5"
                    >
                        <path fill="#ebebeb" d="M2.704 123.606h240v80h-240z" />
                        <path d="M242.704 203.605h-240v-79.999h240v80zm-237-77v74.001h234v-74h-234z" />
                        <path fill="#ebebeb" d="M2.704 263.606h240v80h-240z" />
                        <path d="M242.704 343.605h-240v-79.999h240v80zm-237-77v74.001h234v-74h-234z" />
                        <path d="M132.304 244.407l-9.6 19.2-9.6-19.2h19.2z" />
                        <path d="M122.704 203.606v44.64" fill="none" stroke="#000" stroke-width="8" />
                        <path fill="#ebebeb" d="M322.704 123.606h240v80h-240z" />
                        <path d="M562.704 203.605h-240v-79.999h240v80zm-237-77v74.001h234v-74h-234z" />
                        <path fill="#ebebeb" d="M322.704 263.606h240v80h-240z" />
                        <path d="M562.704 343.605h-240v-79.999h240v80zm-237-77v74.001h234v-74h-234zM436.704 111.606l6 12 6-12h-12zM128.704 111.606l-6 12-6-12h12z" />
                        <path
                            d="M442.704 114.006v-50.4h-320v50.4"
                            fill="none"
                            stroke="#000"
                            stroke-width="4"
                            stroke-linejoin="miter"
                        />
                        <path
                            d="M517.939 32.15v75.383h-320V33.032"
                            fill="none"
                            stroke="#000"
                            stroke-width="4.41"
                            stroke-linejoin="miter"
                            transform="matrix(1 0 0 .80536 -75.235 317.004)"
                        />
                        <g>
                            <path d="M452.304 244.407l-9.6 19.2-9.6-19.2h19.2z" />
                            <path d="M442.704 203.606v44.64" fill="none" stroke="#000" stroke-width="8" />
                        </g>
                        <g>
                            <text
                                x="196.675"
                                y="150.71"
                                font-family="'HelveticaNeue','Helvetica Neue'"
                                font-size="30"
                                transform="translate(-97.296 23.606)"
                            >File
                            </text>
                        </g>
                        <g>
                            <text
                                x="131.095"
                                y="150.71"
                                font-family="'HelveticaNeue','Helvetica Neue'"
                                font-size="30"
                                transform="translate(-97.296 163.606)"
                            >
                                Data process
                            </text>
                        </g>
                        <g>
                            <text
                                x="163.63"
                                y="150.71"
                                font-family="'HelveticaNeue','Helvetica Neue'"
                                font-size="30"
                                transform="translate(222.704 22.896)"
                            >Network
                            </text>
                        </g>
                        <g>
                            <text
                                x="131.095"
                                y="150.71"
                                font-family="'HelveticaNeue','Helvetica Neue'"
                                font-size="30"
                                transform="translate(222.704 162.896)"
                            >
                                Data process
                            </text>
                        </g>
                        <g>
                            <path
                                d="M282.704 63.606v-60"
                                fill="none"
                                stroke="#000"
                                stroke-width="4"
                                stroke-linejoin="miter"
                            />
                        </g>
                        <g>
                            <path d="M288.704 451.606l-6 12-6-12h12z" />
                            <path
                                d="M282.704 403.606v50.4"
                                fill="none"
                                stroke="#000"
                                stroke-width="4"
                                stroke-linejoin="miter"
                            />
                        </g>
                    </svg>
                </div>
                <div class="fragment">
                    <p>asynchronous</p>
                    <svg
                        width="420px"
                        viewBox="0 0 566 554"
                        xmlns="http://www.w3.org/2000/svg"
                        fill-rule="evenodd"
                        clip-rule="evenodd"
                        stroke-linejoin="round"
                        stroke-miterlimit="1.5"
                    >
                        <path fill="#ebebeb" d="M2.7 76.971h240v80H2.7z" />
                        <path d="M242.7 156.97H2.7V76.971h240v80zm-237-77v74.001h234v-74H5.7z" />
                        <path fill="#ebebeb" d="M322.7 176.971h240v80h-240z" />
                        <path d="M562.7 256.97h-240v-79.999h240v80zm-237-77v74.001h234v-74h-234zM128.7 64.971l-6 12-6-12h12z" />
                        <path
                            d="M122.704 16.971v50.4"
                            fill="none"
                            stroke="#000"
                            stroke-width="4"
                            transform="translate(-.005)"
                        />
                        <path d="M452.299 157.772l-9.6 19.2-9.6-19.2h19.2z" />
                        <path
                            d="M242.704 116.971h200v44.64"
                            fill="none"
                            stroke="#000"
                            stroke-width="8"
                            stroke-linejoin="miter"
                            transform="translate(-.005)"
                        />
                        <path fill="#ebebeb" d="M2.7 356.971h240v80H2.7z" />
                        <path d="M242.7 436.97H2.7v-79.999h240v80zm-237-77v74.001h234v-74H5.7z" />
                        <path fill="#ebebeb" d="M322.7 456.971h240v80h-240z" />
                        <path d="M562.7 536.97h-240v-79.999h240v80zm-237-77v74.001h234v-74h-234zM128.7 344.972l-6 12-6-12h12z" />
                        <path
                            d="M122.704 157.681v189.69"
                            fill="none"
                            stroke="#000"
                            stroke-width="4"
                            transform="translate(-.005)"
                        />
                        <g>
                            <path d="M128.7 524.972l-6 12-6-12h12z" />
                            <path
                                d="M122.704 436.971v90.4"
                                fill="none"
                                stroke="#000"
                                stroke-width="4"
                                transform="translate(-.005)"
                            />
                        </g>
                        <g>
                            <path d="M452.299 437.772l-9.6 19.2-9.6-19.2h19.2z" />
                            <path
                                d="M242.704 396.971h200v44.64"
                                fill="none"
                                stroke="#000"
                                stroke-width="8"
                                stroke-linejoin="miter"
                                transform="translate(-.005)"
                            />
                        </g>
                        <g>
                            <text
                                x="196.675"
                                y="150.71"
                                font-family="'HelveticaNeue','Helvetica Neue'"
                                font-size="30"
                                transform="translate(-97.3 -23.03)"
                            >File
                            </text>
                        </g>
                        <g>
                            <text
                                x="131.095"
                                y="150.71"
                                font-family="'HelveticaNeue','Helvetica Neue'"
                                font-size="30"
                                transform="translate(222.7 76.97)"
                            >
                                Data process
                            </text>
                        </g>
                        <g>
                            <text
                                x="163.63"
                                y="150.71"
                                font-family="'HelveticaNeue','Helvetica Neue'"
                                font-size="30"
                                transform="translate(-97.3 256.26)"
                            >Network
                            </text>
                        </g>
                        <g>
                            <text
                                x="131.095"
                                y="150.71"
                                font-family="'HelveticaNeue','Helvetica Neue'"
                                font-size="30"
                                transform="translate(222.7 356.26)"
                            >
                                Data process
                            </text>
                        </g>
                    </svg>
                </div>
            </div>

            <aside class="notes">
                Let’s remember how we were writing our first code. I bet it was like a sequence commands which were
                running strictly one by one, first line, second line and so on…
                But we were growing up and we wanted to use our hardware more effectively, for example read from disk
                and send something by network simultaneously.

                Then we got a multithreading. But with this powerful tool we also got a bunch of problems like thread
                syncing, deadlocks, race conditions.

                But actually there is a compromise to run tasks simultaneously and don’t think about multi-threading
                problems. And it’s an asynchronous tasks running.
            </aside>
        </section>

        <section>
            <h2>Asynchronous in action</h2>
            <ol>
                <li>Print a file content</li>
                <li>Print a remote value with 3 seconds delay</li>
            </ol>
            <aside class="notes">
                Here is an example of two asynchronous tasks.
                Let’s figure out how we are able to do that with JavaScript.
            </aside>
        </section>

        <section>
            <h2>Code</h2>
            <pre><code
                class="language-js"
                data-trim
                data-line-numbers
            >
const fs = require('fs');
const request = require('request');
let val1;
let val2;
 
fs.readFile('/tmp/nine', (err, data) => {
  val1 = data;
  console.log(val1);
});
 
request('https://alexey.detr.us/val', (err, data) => {
  val2 = data.body;
  setTimeout(() => {
    console.log(val2);
  }, 3000);
});
            </code></pre>
            <div class="fragment fragment-highlight-line" data-line-numbers="6"></div>
            <div class="fragment fragment-highlight-line" data-line-numbers="11"></div>
            <div class="fragment fragment-highlight-line" data-line-numbers="13"></div>
            <div class="fragment fragment-highlight-line" data-line-numbers="8"></div>
            <div class="fragment fragment-highlight-line" data-line-numbers="14"></div>
            <aside class="notes">
            </aside>
        </section>

        <section>
            <h1>
                Node.js is <strong>more</strong> than<br />
                just a JavaScript
            </h1>
        </section>

        <section>
            <h2>Asynchronous Node.js</h2>

            <div class="columns-2-narrow">
                <div>
                    <pre><code
                        class="language-js"
                        data-trim
                        data-line-numbers
                    >
                        fs.readFile((err, data) => {
                        });
                         
                        request((err, data) => {
                          setTimeout(() => {
                          }, 3000);
                        });
                    </code></pre>
                    <div class="fragment fragment-highlight-line" data-line-numbers="1" data-fragment-index="1"></div>
                    <div class="fragment fragment-highlight-line" data-line-numbers="4" data-fragment-index="2"></div>
                    <div class="fragment fragment-highlight-line" data-line-numbers="5" data-fragment-index="3"></div>
                </div>
                <div>
                    <h3 class="fragment">libuv</h3>
                    <div class="block fragment" data-fragment-index="1">Thread pool</div>
                    <div class="block fragment" data-fragment-index="2">Non-blocking sockets</div>
                    <div class="block fragment" data-fragment-index="3">Timers</div>
                </div>
            </div>
        </section>

        <section>
            <h2>libuv</h2>
            <div class="columns-2-narrow">
                <div>
                    <div class="columns-2 fragment" data-fragment-index="1">
                        <div>
                            <div class="block">TCP</div>
                            <div class="block">TTY</div>
                        </div>
                        <div>
                            <div class="block">UDP</div>
                            <div class="block">Pipe</div>
                        </div>
                    </div>
                    <div class="fragment" data-fragment-index="2">
                        <div>...</div>
                        <h3>OS Async API</h3>
                    </div>
                    <div class="columns-2 fragment" data-fragment-index="2">
                        <div>
                            <div class="block">epoll</div>
                            <div class="block">event ports</div>
                        </div>
                        <div>
                            <div class="block">kqueue</div>
                            <div class="block">IOCP</div>
                        </div>
                    </div>
                </div>
                <div class="fragment" data-fragment-index="3">
                    <div class="block">FS Input / Output</div>
                    <div class="block">DNS</div>
                    <div class="block">Heavy binary modules</div>
                    <h3>Thread pool</h3>
                </div>
            </div>
        </section>

        <section>
            <h1>Event loop</h1>

        </section>

        <section>
            <h2>Event loop and phases</h2>
        </section>
    </div>
</div>

<script src="js/reveal.js"></script>

<script>
    // More info about config & dependencies:
    // - https://github.com/hakimel/reveal.js#configuration
    // - https://github.com/hakimel/reveal.js#dependencies
    Reveal.initialize({
        hash: true,
        slideNumber: true,
        fragments: true,
        fragmentInURL: true,
        width: '100%',
        height: '100%',
        margin: 0.1,
        minScale: 1,
        maxScale: 1,
        dependencies: [
            { src: 'plugin/markdown/marked.js' },
            { src: 'plugin/markdown/markdown.js' },
            { src: 'plugin/notes/notes.js', async: true },
            { src: 'plugin/highlight/highlight.js', async: true },
        ],
    });
</script>

<script>
    function cleanHighlight(codeElement) {
        codeElement.querySelectorAll('table tr').forEach((line) => {
            line.classList.remove('highlight-line');
        });
    }

    Reveal.addEventListener('ready', function () {
        Reveal.addEventListener('fragmentshown', (params) => {
            const { fragment } = params;
            if (fragment.classList.contains('fragment-highlight-line')) {
                const codeElement = fragment.parentNode.querySelector('code');
                cleanHighlight(codeElement);
                codeElement.classList.add('highlight-lines');
                Reveal.getPlugin('highlight').highlightLines(codeElement, fragment.dataset.lineNumbers);
            }
        });

        Reveal.addEventListener('fragmenthidden', (params) => {
            const { fragment } = params;
            if (fragment.classList.contains('fragment-highlight-line')) {
                const codeElement = fragment.parentNode.querySelector('code');
                const previousSibling = fragment.previousElementSibling;
                cleanHighlight(codeElement);
                if (previousSibling.classList.contains('fragment-highlight-line')) {
                    Reveal.getPlugin('highlight').highlightLines(codeElement, previousSibling.dataset.lineNumbers);
                } else {
                    codeElement.classList.remove('highlight-lines');
                }
            }
        });
    });
</script>
</body>
</html>
